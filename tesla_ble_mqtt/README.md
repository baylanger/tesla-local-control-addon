# Home Assistant Add-on: Tesla Local Commands

This Addon is a package of iainbullock's https://github.com/iainbullock/tesla_ble_mqtt_docker
It runs the official Tesla Vehicle SDK commands via BLE to activate various entities in your Tesla.
This is to bypass the current Fleet API rate limitation.

It does not rely on the API.

This package contains:
- All the code generated by iainbullock repackaged as a HA addon
- A `standalone` folder which contains a single script to run the BLE service on a separate machine

# Tesla BLE MQTT Docker

Send commands via MQTT to a Tesla car using Bluetooth Low Energy (BLE)

If Home Assistant (HA) is already using the MQTT integration, then the various entities will be auto-discovered by HA

The advantage of the MQTT setup is that it can run on a device separate to your HA server, e.g. Raspberry Pi located close to where you park your car 

## Installation and setup

1 You must already have a working MQTT broker. If you want the entities to be auto-discovered by Home Assistant (HA), then the HA MQTT Integration must already be set up and working. See: https://www.home-assistant.io/integrations/mqtt/

Note that in both cases below, if you have already created a key pair that you want to reuse, place the private key in `/share/tesla_ble_mqtt`

2.1 For the HA Add-on:

[![Open your Home Assistant instance and show the add add-on repository dialog with a specific repository URL pre-filled.](https://my.home-assistant.io/badges/supervisor_add_addon_repository.svg)](https://my.home-assistant.io/redirect/supervisor_add_addon_repository/?repository_url=https://github.com/raphmur/tesla-local-control-addon)

2.2 For the standalone version, it has been tested on RPi 3B so far. Here are the assumptions and way forward:
- You already have Docker working on the host device, and you are familiar with basic Docker concepts and actions
- Clone the self packaged shell script: `https://github.com/raphmur/tesla-local-control-addon/blob/main/standalone/start_tesla_ble_mqtt.sh`
- Edit the script to input your own settings: VIN, MQTT_IP (ip of your MQTT server), MQTT_PORT, MQTT_USER, MQTT_PWD, _optional_ _SEND_CMD_RETRY_DELAY_ (delay between retries in case BLE fails), _optional_ _BLE_MAC_ (to be used for proximity discovery)
- run the script: `./start_tesla_ble_mqtt.sh`, it will download the rest of the elements, build and deploy the container

3 THEN:

- A new device called Tesla_BLE_MQTT should have automatically appeared. Click it to view the the associated entities. You should find a list of Button entities and a Number entity
- If this is the first time you have run the container, press the 'Generate Keys' button. This will generate the public and private keys as per Shanker's blog
- Wake up your car using the Tesla App. Then press the 'Deploy Key' button. This will deploy the public key to the car. You will then need to access your car and use a Key Card to accept the public key into the car (see the blog for screenshots)
- Then you are ready. Press the other button entities to send various commands, or change the Charging Current. You can use the relevant service calls in HA automations if you wish

## Credits

Full package originally built by https://github.com/iainbullock following exchanges on the Tesla Custom Integration Issues https://github.com/alandtse/tesla/issues/961#issuecomment-2150897886 

The technical method was derived from Shankar Kumarasamy's blog https://shankarkumarasamy.blog/2024/01/28/tesla-developer-api-guide-ble-key-pair-auth-and-vehicle-commands-part-3